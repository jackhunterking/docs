---
title: "Tracking (Pixel + Conversions API)"
description: "Set up Meta Pixel + Conversions API with AdsGateway's setup wizard, audit checks, and gateway."
---

AdsGateway Tracking is optional. It helps you set up Meta Pixel and Conversions API (CAPI) and provides a multi-tenant gateway for server-side delivery.

<Info>
  Tracking is available now. Ad editing/updating and ad-writing features are <a href="/feature-availability">Coming Soon</a>.
</Info>

## Recommended Flow (Audit-Ready)

1. Run `setup_meta_tracking` with your `site_url`
2. Connect/reconnect Meta when prompted
3. Select ad account and Pixel, then explicitly confirm Pixel
4. Choose components (`setup_pixel`, `setup_capi`)
5. Choose objective and event plan (when prompted), then confirm event plan
6. Create site + key with `confirm_create_site="CREATE_SITE"`
7. Fetch snippets via `meta_tracking_snippets_get`
8. Send a test event (`confirm_send_test_event="SEND_TEST_EVENT"`)
9. Run `meta_tracking_setup_audit` and execute any `next_actions`

## Event-Plan Driven Setup (V3)

Tracking setup can return additional guided stages:

- `choose_objective`
- `choose_events`
- `confirm_event_plan`

This enables objective-based event planning, verification matrices, and AI-ready implementation copy blocks in setup outputs.

## Keys and Auth Model

AdsGateway uses bearer keys for the Tracking Gateway:

- `sk_...` (secret key): default and required for server-side CAPI delivery
- `pk_...` (publishable key): optional and more restricted

Default behavior:

- AdsGateway provisions a single site secret key (`sk_...`) by default.
- Keys are shown only once at creation/rotation time.
- Use `meta_tracking_keys_rotate` to issue a new key if the original is lost.

## Tracking-Ready Meta Connection Requirement

Tracking setup requires a tracking-ready Meta connection (system-user style, non-expiring token semantics).

If setup returns reconnect-related errors, reconnect Meta and continue the same setup session.

For pixel creation permission issues, follow the returned authorization recovery link and resume setup.

## Gateway Endpoint

Your endpoint is returned by snippets/setup outputs and generally looks like:

```text
https://<your-supabase-project>.supabase.co/functions/v1/meta-track/events
```

Requests must include:

```text
Authorization: Bearer sk_...
Content-Type: application/json
```

## Required Event Payload

The gateway accepts both `snake_case` and `camelCase`. Required fields:

| Field | Type | Notes |
|------|------|------|
| `event_name` | string | Example: `PageView`, `Purchase` |
| `event_time` | number | Unix seconds |
| `event_id` | string | Shared id for Pixel + CAPI dedupe |
| `event_source_url` | string | Full URL; hostname must match configured site |

## Dedupe Rules (Pixel + CAPI)

1. Generate one stable `event_id` per user action
2. Send Pixel event with that id
3. Send CAPI event with the same id

The gateway also deduplicates on `(site_id, event_name, event_id)`.

## Troubleshooting (Start Here)

Start with:

```text
meta_tracking_setup_audit(site_id=..., lookback_hours=24)
```

Then follow `issues[]` and `next_actions[]` in order.

Typical follow-ups:

- `meta_tracking_snippets_get` for implementation checks
- `meta_tracking_events_list` for failure/error inspection
- `meta_tracking_keys_rotate` if key recovery is needed
- `meta_tracking_verify` (or setup verify step) for end-to-end confirmation

## Security Model (Enforced)

- Authorization header required (`Bearer <pk_/sk_>`)
- Origin allowlist enforced for `pk_` keys
- `event_source_url` hostname must match configured hostnames
- `pk_` keys cannot send raw high-risk PII fields
- Tracking logs store metadata and Meta response details, not raw user PII payloads
